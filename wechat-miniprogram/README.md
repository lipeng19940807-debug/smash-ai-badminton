# 微信小程序开发说明

## 常见错误解决

### 1. 网络连接错误 `ERR_CONNECTION_REFUSED`

**错误原因：**
- 后端服务未启动
- IP 地址配置不正确
- 微信开发者工具未配置"不校验合法域名"

**解决方法：**

#### 步骤 1：检查后端服务是否启动
```bash
# 进入后端目录
cd backend

# 启动后端服务
python run.py
```

确保后端服务运行在 `http://localhost:8000` 或你配置的 IP 地址。

#### 步骤 2：配置小程序 API 地址

编辑 `utils/config.js` 文件，修改 `BASE_URL`：

```javascript
const DEV_CONFIG = {
    // 如果后端运行在本地，使用：
    BASE_URL: 'http://localhost:8000/api',
    
    // 或者使用本机局域网 IP（需要根据实际情况修改）
    // BASE_URL: 'http://192.168.31.54:8000/api',
};
```

**如何获取本机 IP：**
- Mac/Linux: 在终端运行 `ifconfig` 或 `ip addr`
- Windows: 在 CMD 运行 `ipconfig`
- 找到局域网 IP（通常是 192.168.x.x 或 10.x.x.x）

#### 步骤 3：配置微信开发者工具

1. 打开微信开发者工具
2. 点击工具栏 -> **详情**
3. 在 **本地设置** 中勾选：
   - ✅ **不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书**

#### 步骤 4：重启小程序

修改配置后，在微信开发者工具中点击 **编译** 按钮重新编译小程序。

## 开发环境配置

### 修改 API 地址

编辑 `utils/config.js`：

```javascript
const ENV = 'development'; // 开发环境
// const ENV = 'production'; // 生产环境

const DEV_CONFIG = {
    BASE_URL: 'http://your-ip:8000/api', // 修改为你的后端地址
};
```

### 环境切换

在 `utils/config.js` 中修改 `ENV` 变量：
- `development`: 使用开发环境配置
- `production`: 使用生产环境配置

## 功能说明

### 登录流程

1. 小程序启动时自动尝试微信登录
2. 如果登录失败，用户可以在首页点击"立即登录"按钮
3. 登录成功后，Token 会保存在本地存储中

### 上传视频流程

1. 点击"上传杀球视频"按钮
2. 选择视频（相册或拍摄）
3. 视频上传到后端
4. 调用 AI 分析接口
5. 显示分析结果

## 调试技巧

### 查看网络请求

1. 在微信开发者工具中打开 **调试器**
2. 切换到 **Network** 标签
3. 查看请求和响应详情

### 查看日志

1. 在微信开发者工具中打开 **调试器**
2. 切换到 **Console** 标签
3. 查看错误日志和调试信息

### 清除缓存

如果遇到奇怪的问题，可以尝试：
1. 点击工具栏 -> **清缓存** -> **清除数据缓存**
2. 重新编译小程序

## 注意事项

1. **开发环境**必须勾选"不校验合法域名"，否则无法连接本地后端
2. **生产环境**需要在微信公众平台配置服务器域名
3. 确保后端服务已启动并可以访问
4. IP 地址变化时需要更新 `utils/config.js` 中的配置
