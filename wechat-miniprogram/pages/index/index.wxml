<!--pages/index/index.wxml-->
<view class="page-container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="header">
    <view class="header-content">
      <view class="user-info" wx:if="{{isLoggedIn && userInfo}}">
        <image class="avatar" src="{{userInfo.avatar_url || ''}}" mode="aspectFill" binderror="handleImageError" data-type="avatar"></image>
        <view class="user-text">
          <text class="welcome-text">æ¬¢è¿å›æ¥</text>
          <text class="username">{{userInfo.nickname || userInfo.username}}</text>
        </view>
      </view>
      <view class="user-info" wx:else>
        <view class="user-text">
          <text class="welcome-text">æœªç™»å½•</text>
          <view class="login-btn-wrapper">
            <button class="login-btn" size="mini" bindtap="handleLogin">ç«‹å³ç™»å½•</button>
          </view>
        </view>
      </view>
      <view class="header-actions">
        <view class="icon-btn" bindtap="goToProfile" wx:if="{{isLoggedIn}}">
          <text class="icon">ğŸ‘¤</text>
        </view>
        <view class="icon-btn" wx:if="{{!isLoggedIn}}">
          <text class="icon">ğŸ””</text>
        </view>
        <view class="icon-btn" wx:if="{{!isLoggedIn}}">
          <text class="icon">âš™ï¸</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <scroll-view class="content" scroll-y>
    <!-- Heroå¡ç‰‡ - æ˜¾ç¤ºæœ€ä½³æ€çƒé€Ÿåº¦ -->
    <view class="hero-card" wx:if="{{isLoggedIn}}">
      <view class="hero-badge">
        <text class="badge-text">{{heroData.level || 'åˆçº§'}}</text>
      </view>
      <view class="hero-content">
        <view class="hero-left">
          <view class="rank-info">
            <text class="rank-label">å…¨å›½æ’å:</text>
            <text class="rank-value">ç¬¬ {{heroData.rank || 0}} å</text>
          </view>
          <view class="speed-display">
            <text class="speed-number">{{heroData.bestSpeed || 0}}</text>
            <text class="speed-unit">km/h</text>
          </view>
          <text class="speed-label">ä¸ªäººæœ€ä½³æ€çƒæ—¶é€Ÿ</text>
        </view>
        <button class="detail-btn" bindtap="switchToProfile">è¯¦ç»†æ•°æ®</button>
      </view>
    </view>

    <!-- å¼€å§‹åˆ†ææŒ‰é’® -->
    <view class="action-section">
      <button class="start-btn neon-glow" bindtap="handleChooseVideo" disabled="{{!isLoggedIn}}">
        <text class="btn-icon">ğŸ“¹</text>
        <text>å¼€å§‹åˆ†ææ€çƒ</text>
      </button>
    </view>

    <!-- AIæ™ºèƒ½å»ºè®®å¡ç‰‡ -->
    <view class="ai-insight-card" wx:if="{{isLoggedIn && recentRecords.length > 0}}">
      <view class="insight-icon">ğŸ§ </view>
      <view class="insight-content">
        <text class="insight-label">AI æ™ºèƒ½å»ºè®®</text>
        <text class="insight-text">ä½ åœ¨ä¸Šä¸€åœºè®­ç»ƒä¸­çš„è¡¨ç°æå‡äº† <text class="highlight">12%</text>ã€‚è¯·ç»§ç»­ä¿æŒè¿™ä¸ªæŒ¥æ‹èŠ‚å¥ï¼</text>
      </view>
    </view>

    <!-- æœ€è¿‘è®°å½• -->
    <view class="records-section" wx:if="{{isLoggedIn && recentRecords.length > 0}}">
      <view class="section-header">
        <text class="section-title">æœ€è¿‘è®°å½•</text>
        <text class="section-more" bindtap="switchToProfile">æŸ¥çœ‹å…¨éƒ¨ ></text>
      </view>
      <view class="records-grid">
        <view class="record-card" wx:for="{{recentRecords}}" wx:key="id" bindtap="viewRecordDetail" data-id="{{item.id}}">
          <view class="record-thumbnail" wx:if="{{item.thumbnail}}" style="background-image: url('{{item.thumbnail}}')">
            <view class="record-overlay"></view>
            <view class="record-speed-badge">
              <text class="speed-icon">âš¡</text>
              <text>{{item.speed}} km/h</text>
            </view>
          </view>
          <view class="record-thumbnail" wx:else>
            <view class="record-thumbnail-placeholder">ğŸ¸</view>
            <view class="record-overlay"></view>
            <view class="record-speed-badge">
              <text class="speed-icon">âš¡</text>
              <text>{{item.speed}} km/h</text>
            </view>
          </view>
          <view class="record-info">
            <view class="record-header">
              <text class="record-title">{{item.title}}</text>
              <text class="record-tag">{{item.level}}</text>
            </view>
            <view class="record-footer">
              <text class="record-date">{{item.date}}</text>
              <text class="record-count">{{item.count || 1}} æ¬¡æ€çƒ</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æœªç™»å½•æç¤º -->
    <view class="empty-state" wx:if="{{!isLoggedIn}}">
      <text class="empty-icon">ğŸ¸</text>
      <text class="empty-text">ç™»å½•åæŸ¥çœ‹ä½ çš„æ€çƒè®°å½•</text>
      <button class="empty-btn" bindtap="handleLogin">ç«‹å³ç™»å½•</button>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨å¯¼èˆªæ  -->
  <view class="bottom-nav">
    <view class="nav-item active">
      <text class="nav-icon">ğŸ </text>
      <text class="nav-label">é¦–é¡µ</text>
    </view>
    <view class="nav-item">
      <text class="nav-icon">ğŸ“Š</text>
      <text class="nav-label">è®­ç»ƒè®°å½•</text>
    </view>
    <view class="nav-item">
      <text class="nav-icon">ğŸ†</text>
      <text class="nav-label">æ’è¡Œæ¦œ</text>
    </view>
    <view class="nav-item" bindtap="switchToProfile">
      <text class="nav-icon">ğŸ‘¤</text>
      <text class="nav-label">ä¸ªäººä¸­å¿ƒ</text>
    </view>
  </view>

  <!-- åˆ†æä¸­é®ç½© -->
  <view class="analyzing-overlay" wx:if="{{isAnalyzing}}">
    <view class="analyzing-content">
      <view class="loading-spinner"></view>
      <text class="analyzing-text">{{statusText}}</text>
    </view>
  </view>
</view>
